<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Dongle&family=Gamja+Flower&family=Nanum+Myeongjo&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<title>Insert title here</title>
<style type="text/css">
	.board-row,div.detail{
		display: flex;
		align-items: center;
		padding: 8px 10px;
		border-bottom: 1px solid #ddd;
		font-size: 15px;
	}
	.board-row span{
		margin-right: 20px
	}
	.board-row .name{
		width: 120px;
		font-weight: 600;		
	}
	.board-row .sub{
		cursor: pointer;
		flex: 1;
	}
	.board-row .day{
		white-space: nowrap;
		font-size: 0.8em;
		color: gray;
	}
	i{
		cursor:pointer;
		margin-right: 8px;
	}
	
	.board-header{
   	 	display: flex;
    	align-items: center;
    	padding: 8px 10px;
    	border-bottom: 2px solid #999;
    	font-weight: bold;
    	background-color: #f8f9fa;
	}
	.board-header span{
	    margin-right: 20px;
	}
	.board-header .name{
    	width: 120px;
	}
	.board-header .sub{
    	flex: 1;
	}
	.board-header .day{
    	white-space: nowrap;
    	font-size: 0.9em;
	}
	span.day{
		float: right;
		color: gray;
		font-size: 0.8em;
	}
	td b{
		font-size: 1.4em;
		font-weight: bold;
	}
	span.name{
		font-size: 0.8em;
		font-weight: 400;
	}
	.detail button{
		margin-right: 5px;
	}
</style>
<script type="text/javascript">
	$(function(){
		
		list();
		
		$("div.addform").hide();
		$("div.updateform").hide();
		
		$("#write").click(function(){
			$("div.addform").toggle();
		});
		
		//db에 저장
		$("#btn").click(function(){
			var data=$("#addfrm").serialize();
			
			$.ajax({
				type:"post",
				dataType:"html",
				url:"insertBoard.jsp",
				data:data,
				success:function(){
					alert("저장 완료");
					
					$("#name").val("");
					$("#subject").val("");
					$("#content").val("");
					
					list();
				}
			});
		});
		
		$(document).on("change","#uemot",function(){
			var img=$(this).val();
			$("#uemotimg").attr("src",img);
		});
		
	})
	
	function list(){
		
		$.ajax({
			type:"get",
			url:"listBoard.jsp",
			dataType:"json",
			success:function(data){
				var s="";
				
				if(data.length==0){
					s+="<h4 class='alert alert-success'>내용을 입력해주세요.</h4>"
				}else{
					$.each(data,function(i,elt){
					s+="<div class='board-row'>"
					s+="<span class='name'>"+elt.name+"</span>";
					s+="<span class='sub' num="+elt.num+">"+elt.subject+"</span>";
					s+="<span class='day'>"+elt.writeday+"</span>";
					s+="</div>"
					})
				}
				$("#boardlist").html(s);
			}
		});
		
		
		//제목클릭시 리스트 숨기고 디테일 나타나게 하기
		$(document).on("click","span.sub",function(){
			//span태그에 넣어둔 num 가져오기
			var num=$(this).attr("num");
			//alert(num);
			
			$.ajax({
				type:"get",
				dataType:"json",
				url:"detailBoard.jsp",
				data:{"num":num},
				success:function(res){
					var s="<table class='table table-bordered'>";
					s+="<tr>";
					s+="<td><b>"+res.subject+"</b>";
					s+="<span class='day'>"+res.writeday+"</span>";
					s+="<br><span class='name'>"+res.name+"</span></td>";
					s+="</tr>";
					s+="<tr><td>";
					s+="<img src='"+res.emot+"' hspacs='20'>";
					s+="<pre>"+res.content+"</pre></td></tr>";
					s+="<tr><td align='right'>";
					s+="<button type='button' class='btn btn-outline-info btnlist'>목록</button>";
					s+="<button type='button' class='btn btn-outline-info mod' num='"+res.num+"'><i class='bi bi-pencil-square'></i></button>";
					s+="<button type='button' class='btn btn-outline-info del' num='"+res.num+"'><i class='bi bi-trash'></i></button>";
					s+="</td></tr></table>";

					$("div.detail").html(s);
					
					//list 숨기기
					$("div.list").hide();
					//detail보이게
					$("div.detail").show();
				}
			});
		});
		
		
		//목록버튼 누르면 디테일 사라지고 리스트 나오게
		$(document).on("click",".btnlist",function(){
			
			$("div.detail").hide();
			$("div.list").show();
			
		});
		
		
		//삭제
		$(document).on("click",".del",function(){
			var num=$(this).attr("num");
			
			if(!confirm("삭제하시겠습니까?")){
				return;
			}
			
			$.ajax({
				type:"post",
				url:"deleteBoard.jsp",
				dataType:"html",
				data:{"num":num},
				success:function(){
					alert("삭제되었습니다.");
					
					$("div.detail").hide();
					
					list();
					
					$("div.list").show();
				}
				
			});
		});
		
		
		//수정
		$(document).on("click",".mod",function(){
			
			var num=$(this).attr("num");
			//alert(num);
			
			$.ajax({
				type:"get",
				url:"detailBoard.jsp",
				dataType:"json",
				data:{"num":num},
				success:function(res){
					$("#unum").val(res.num);
					$("#uname").val(res.name);
					$("#usubject").val(res.subject);
					$("#ucontent").val(res.content);
					$("#uemot").val(res.emot);
					
					//디테일페이지 안보이게
					$("div.detail").hide();
					//수정폼 보이게
					$("div.updateform").show();
					
				}
				
			});
			
		});
		
		$("#uemot").change(function(){
			var img=$(this).val();
			$("#emotimg").attr("src",img);
		});
		
		
		//수정완료
		$(document).on("click","#ubtn",function(){
			var data=$("#updatefrm").serialize();
			
			$.ajax({
				type:"post",
				url:"updateBoard.jsp",
				dataType:"html",
				data:data,
				success:function(){
					alert("수정 완료 되었습니다.");
					$("div.updateform").hide();
					list();
					$("div.list").show();
				}
			})
		});
		
	}
	
</script>
</head>
<body>
<!-- 리스트 -->
<div class="list" style="margin: 50px 50px;">
	<button class="btn btn-secondary" id="write" style="margin-bottom: 30px;">글쓰기</button>
	<div class="board-header">
    <span class="name">작성자</span>
    <span class="sub">제목</span>
    <span class="day">작성일</span>
    <span style="width:50px;"></span>
</div>
	<div id="boardlist"></div>
</div>

<!-- 글쓰기 내용 -->
	<div class="addform" style="margin: 0px 50px;">
		<form id="addfrm">
			<table class="table table-bordered">
				<caption align="top"><b>인사말 수정하기</b></caption>
				<tr>
					<th width="100" class="table-secondary">작성자</th>
					<td>
						<input type="text" class="form-control" name="name" id="name" style="width: 120px;">
					</td>
				</tr>
				<tr>
					<th width="100" class="table-secondary">제목</th>
					<td>
						<input type="text" class="form-control" name="subject" id="subject" style="width: 120px;">
					</td>
				</tr>
				<tr>
					<th width="100" class="table-secondary">인사말</th>
					<td>
						<textarea style="width: 300px; height: 80px;" class="form-control"
						name="content" id="content"></textarea>
					</td>
				</tr>
				<tr>
					<th width="100" class="table-secondary">이모티콘</th>
					<td>
						<select name="emot" id="emot">
							<option value="../image/avata/b1.png">사랑해</option>
							<option value="../image/avata/b2.png">심심</option>
							<option value="../image/avata/b3.png">하이</option>
							<option value="../image/avata/b5.png">배고파</option>
							<option value="../image/avata/b6.png">좌절</option>
							<option value="../image/avata/b7.png">신남</option>
							<option value="../image/avata/b8.png">비웃음</option>
						</select>
						<img alt="" src="../image/avata/b1.png" style="width: 50px;" id="emotimg">
					</td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-light" id="btn">DB에 저장하기</button>
					</td>
				</tr>
			</table>
		</form>
	</div>
	
	<!-- subject 페이지 -->
	<div class="detail"></div>
	
	<!-- 수정 페이지 -->
	<div class="updateform" style="margin: 0px 50px;">
		<form id="updatefrm">
		<!-- hidden -->
		<input type="hidden" name="unum" id="unum">
			<table class="table table-bordered">
				<caption align="top"><b>인사말 남기기</b></caption>
				<tr>
					<th width="100" class="table-secondary">작성자</th>
					<td>
						<input type="text" class="form-control" name="uname" id="uname" style="width: 120px;">
					</td>
				</tr>
				<tr>
					<th width="100" class="table-secondary">제목</th>
					<td>
						<input type="text" class="form-control" name="usubject" id="usubject" style="width: 120px;">
					</td>
				</tr>
				<tr>
					<th width="100" class="table-secondary">인사말</th>
					<td>
						<textarea style="width: 300px; height: 80px;" class="form-control"
						name="ucontent" id="ucontent"></textarea>
					</td>
				</tr>
				<tr>
					<th width="100" class="table-secondary">이모티콘</th>
					<td>
						<select name="uemot" id="uemot">
							<option value="../image/avata/b1.png">사랑해</option>
							<option value="../image/avata/b2.png">심심</option>
							<option value="../image/avata/b3.png">하이</option>
							<option value="../image/avata/b5.png">배고파</option>
							<option value="../image/avata/b6.png">좌절</option>
							<option value="../image/avata/b7.png">신남</option>
							<option value="../image/avata/b8.png">비웃음</option>
						</select>
						<img alt="" src="../image/avata/b1.png" style="width: 50px;" id="uemotimg">
					</td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<button type="button" class="btn btn-light" id="ubtn">수정 완료</button>
					</td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>